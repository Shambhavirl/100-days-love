<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>pocket post🤍</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <!-- Main Content -->
  <main class="main-content">
    <img id="big-envelope" src="assets/envelope_closed.png" alt="Envelope">
    <div id="day-message"></div>
  </main>

  <!-- Sidebar -->
  <aside class="sidebar" id="opened-days"></aside>
</div>

<!-- Modal -->
<div id="message-modal" class="modal hidden">
  <div class="modal-content">
    <button id="close-modal">&times;</button>
    <div id="modal-message" class="typewriter"></div>
  </div>
</div>

<script>
const storageKey = "ad_love_notes_opened";
let openedDays = JSON.parse(localStorage.getItem(storageKey)) || [];
let currentDay = new Date().getDate(); // Example: Today’s date as day index
let messages = [];

// Force first 24 days open
for (let i = 0; i < 24; i++) {
  if (!openedDays.includes(i)) openedDays.push(i);
}
openedDays.sort((a,b) => a - b);

// Save opened day
function saveOpenedDay(day) {
  if (!openedDays.includes(day)) {
    openedDays.push(day);
    openedDays.sort((a,b) => a - b);
    localStorage.setItem(storageKey, JSON.stringify(openedDays));
    renderSidebar();
  }
}

// Render sidebar
function renderSidebar() {
  const sidebar = document.getElementById("opened-days");
  sidebar.innerHTML = "";
  openedDays.forEach(day => {
    if (messages[day]) {
      const div = document.createElement("div");
      div.className = "mini-envelope";
      div.textContent = `Day ${day + 1}`;
      div.onclick = () => showMessageModal(day);
      sidebar.appendChild(div);
    }
  });
}

// Show modal
function showMessageModal(day) {
  document.getElementById("modal-message").textContent = messages[day];
  document.getElementById("message-modal").classList.remove("hidden");
}

// Close modal
document.getElementById("close-modal").onclick = () => {
  document.getElementById("message-modal").classList.add("hidden");
};

// Load messages.json
fetch("messages.json")
  .then(res => res.json())
  .then(data => {
    messages = data;
    renderSidebar();
  });

// Envelope click to open today’s letter
document.getElementById("big-envelope").onclick = () => {
  if (messages[currentDay]) {
    saveOpenedDay(currentDay);
    showMessageModal(currentDay);
    document.getElementById("big-envelope").src = "assets/envelope_open.png";
  } else {
    alert("No letter for today yet 💌");
  }
};
</script>

</body>
</html>
